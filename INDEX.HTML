<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agenda - Demo</title>
  <style>
    /* Reset simples */
    *{box-sizing:border-box;font-family:Inter, Arial, Helvetica, sans-serif}
    body{margin:0;background:#f3f5f9;color:#222}

    /* Top menu (como na imagem) */
    .topbar{display:flex;align-items:center;gap:8px;padding:8px 14px;background:#2f3b4a;color:#fff}
    .topbar .brand{font-weight:700;margin-right:12px}
    .topbar .tabs{display:flex;gap:6px}
    .tab{background:transparent;border:0;padding:8px 12px;border-radius:6px;cursor:pointer;color:#fff}
    .tab:hover{background:rgba(255,255,255,0.06)}

    .container{display:flex;min-height:calc(100vh - 48px)}

    /* Sidebar */
    .sidebar{width:220px;padding:18px;background:#fff;border-right:1px solid #e6e9ee}
    .menu-title{font-size:14px;color:#7b828b;margin-bottom:8px}
    .menu a{display:block;padding:10px;border-radius:6px;color:#243040;text-decoration:none;margin-bottom:6px}
    .menu a:hover{background:#eef3fb}

    /* Main area */
    .main{flex:1;padding:20px}
    .card{background:#fff;border-radius:8px;padding:14px;box-shadow:0 1px 0 rgba(0,0,0,0.03)}

    /* Header inside main */
    .main-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .btn-primary{background:#233b6b;color:#fff}
    .btn-ghost{background:transparent;border:1px solid #dbe6f7;color:#233b6b}

    /* Users table like image */
    table{width:100%;border-collapse:collapse}
    thead th{background:#eef4ff;padding:10px;text-align:left;color:#2a466f}
    td, th{padding:10px;border-bottom:1px solid #eef1f6}
    .small{font-size:13px;color:#6b7582}

    /* Forms */
    .form-row{display:flex;gap:12px;margin-bottom:10px}
    .form-row input, .form-row select{flex:1;padding:8px;border-radius:6px;border:1px solid #d6dbe6}

    /* Login/Register center box */
    .auth-wrap{display:grid;place-items:center;height:calc(100vh - 48px)}
    .auth-box{width:420px;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 30px rgba(15,30,60,0.06)}
    .auth-box h2{margin:0 0 12px}

    /* Agenda list */
    .appointments{display:flex;flex-direction:column;gap:8px}
    .appt{padding:10px;border-radius:8px;border:1px solid #e6eef9;background:#fff}

    /* Responsive */
    @media(max-width:880px){.sidebar{display:none}.container{flex-direction:column}.auth-box{width:94%}}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">Sistema de Agenda</div>
    <div class="tabs">
      <button class="tab">Segurança</button>
      <button class="tab">Agenda</button>
      <button class="tab">Agenda Adm</button>
      <button class="tab">Comunidade</button>
      <button class="tab">Pastorais</button>
      <button class="tab">Instalações</button>
      <button class="tab">Relatório Agenda</button>
    </div>
  </div>

  <div class="container">
    <aside class="sidebar">
      <div class="menu-title">Usuário</div>
      <div class="menu">
        <a href="#" id="link-login">Login</a>
        <a href="#" id="link-register">Registrar</a>
        <a href="#" id="link-schedule">Minhas Agendas</a>
        <a href="#" id="link-admin">Painel ADM</a>
      </div>
    </aside>

    <main class="main" id="app">
      <!-- Aqui o conteúdo é injetado via JS -->
    </main>
  </div>

<script>
// --- Dados locais (simula backend usando localStorage) ---
const DB_USERS_KEY = 'demo_users_v1';
const DB_APPTS_KEY = 'demo_appts_v1';

function loadUsers(){
  const raw = localStorage.getItem(DB_USERS_KEY);
  if(!raw){
    // cria usuário admin padrão
    const admin = [{id:1,name:'Administrador',email:'admin@admin.com',password:'admin',isAdmin:true,active:true}];
    localStorage.setItem(DB_USERS_KEY,JSON.stringify(admin));
    return admin;
  }
  return JSON.parse(raw);
}
function saveUsers(u){localStorage.setItem(DB_USERS_KEY,JSON.stringify(u));}

function loadAppts(){
  const raw = localStorage.getItem(DB_APPTS_KEY) || '[]';
  return JSON.parse(raw);
}
function saveAppts(a){localStorage.setItem(DB_APPTS_KEY,JSON.stringify(a));}

let currentUser = null;

// --- Helpers ---
function el(html){const div=document.createElement('div');div.innerHTML=html.trim();return div.firstChild}
function showMessage(msg){alert(msg)}

// --- Views ---
function renderLogin(){
  const html = `
    <div class="card auth-box">
      <h2>Entrar</h2>
      <div class="form-row"><input id="login-email" placeholder="E-mail" /></div>
      <div class="form-row"><input id="login-pass" type="password" placeholder="Senha" /></div>
      <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-login">Entrar</button>
      <button class="btn btn-ghost" id="btn-to-register">Registrar</button></div>
    </div>
  `;
  document.getElementById('app').innerHTML = html;
  document.getElementById('btn-login').onclick = ()=>{
    const email = document.getElementById('login-email').value.trim();
    const pass = document.getElementById('login-pass').value;
    const users = loadUsers();
    const user = users.find(u=>u.email.toLowerCase()===email.toLowerCase() && u.password===pass && u.active);
    if(!user){showMessage('E-mail ou senha incorretos, ou usuário inativo.');return}
    currentUser = user;
    renderApp();
  }
  document.getElementById('btn-to-register').onclick = ()=>renderRegister();
}

function renderRegister(){
  const html = `
    <div class="card auth-box">
      <h2>Registrar Conta</h2>
      <div class="form-row"><input id="reg-name" placeholder="Nome" /></div>
      <div class="form-row"><input id="reg-email" placeholder="E-mail" /></div>
      <div class="form-row"><input id="reg-pass" type="password" placeholder="Senha" /></div>
      <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-reg">Criar Conta</button>
      <button class="btn btn-ghost" id="btn-to-login">Voltar</button></div>
    </div>
  `;
  document.getElementById('app').innerHTML = html;
  document.getElementById('btn-reg').onclick = ()=>{
    const name = document.getElementById('reg-name').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const pass = document.getElementById('reg-pass').value;
    if(!name||!email||!pass){showMessage('Preencha todos os campos');return}
    const users = loadUsers();
    if(users.find(u=>u.email.toLowerCase()===email.toLowerCase())){showMessage('E-mail já cadastrado');return}
    const id = (users.reduce((s,u)=>Math.max(s,u.id),0)||0)+1;
    users.push({id,name,email,password:pass,isAdmin:false,active:true});
    saveUsers(users);
    showMessage('Conta criada. Faça login.');
    renderLogin();
  }
  document.getElementById('btn-to-login').onclick = ()=>renderLogin();
}

function renderApp(){
  if(!currentUser){renderLogin();return}
  // se admin, abrir painel admin
  if(currentUser.isAdmin) return renderAdmin();
  // usuário comum: agenda
  const appts = loadAppts().filter(a=>a.userId===currentUser.id);
  const html = `
    <div class="main-header">
      <div>
        <h3>Minhas Agendas — ${currentUser.name}</h3>
        <div class="small">${currentUser.email}</div>
      </div>
      <div>
        <button class="btn btn-ghost" id="btn-logout">Sair</button>
        <button class="btn btn-primary" id="btn-new-appt">Novo Agendamento</button>
      </div>
    </div>
    <div class="card">
      <div class="appointments">
        ${appts.length?appts.map(a=>`<div class="appt"><strong>${a.title}</strong> — ${a.date} ${a.time}<div class="small">Local: ${a.location}</div></div>`).join(''):'<div class="small">Você não tem agendamentos.</div>'}
      </div>
    </div>
  `;
  document.getElementById('app').innerHTML = html;
  document.getElementById('btn-logout').onclick = ()=>{currentUser=null;renderLogin()}
  document.getElementById('btn-new-appt').onclick = ()=>renderNewAppt();
}

function renderNewAppt(){
  const html = `
    <div class="card">
      <h3>Novo Agendamento</h3>
      <div class="form-row"><input id="appt-title" placeholder="Assunto" /></div>
      <div class="form-row"><input id="appt-date" type="date" /></div>
      <div class="form-row"><input id="appt-time" type="time" /></div>
      <div class="form-row"><input id="appt-location" placeholder="Local" /></div>
      <div style="display:flex;gap:8px"><button class="btn btn-primary" id="btn-save-appt">Salvar</button>
      <button class="btn btn-ghost" id="btn-cancel-appt">Cancelar</button></div>
    </div>
  `;
  document.getElementById('app').innerHTML = html;
  document.getElementById('btn-cancel-appt').onclick = ()=>renderApp();
  document.getElementById('btn-save-appt').onclick = ()=>{
    const title = document.getElementById('appt-title').value.trim();
    const date = document.getElementById('appt-date').value;
    const time = document.getElementById('appt-time').value;
    const location = document.getElementById('appt-location').value.trim();
    if(!title||!date||!time||!location){showMessage('Preencha todos os campos');return}
    const appts = loadAppts();
    const id = (appts.reduce((s,a)=>Math.max(s,a.id),0)||0)+1;
    appts.push({id,userId:currentUser.id,title,date,time,location});
    saveAppts(appts);
    showMessage('Agendamento salvo');
    renderApp();
  }
}

function renderAdmin(){
  const users = loadUsers();
  const appts = loadAppts();
  const html = `
    <div class="main-header">
      <div>
        <h3>Painel ADM</h3>
        <div class="small">Usuário: ${currentUser.name} (${currentUser.email})</div>
      </div>
      <div>
        <button class="btn btn-ghost" id="btn-logout">Sair</button>
        <button class="btn btn-primary" id="btn-export">Exportar CSV</button>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h4>USUÁRIOS</h4>
        <div style="display:flex;gap:8px">
          <button class="btn btn-primary" id="btn-new-user">+ Novo</button>
          <input id="search-users" placeholder="Busca Rápida" />
        </div>
      </div>

      <table>
        <thead>
          <tr><th>Foto</th><th>Usuário</th><th>Nome</th><th>E-mail</th><th>Ativo</th><th>Ações</th></tr>
        </thead>
        <tbody>
          ${users.map(u=>`
            <tr>
              <td>—</td>
              <td class="small">${u.email}</td>
              <td>${u.name}</td>
              <td>${u.email}</td>
              <td class="small">${u.active? 'Sim':'Não'}</td>
              <td>
                <button class="btn btn-ghost" data-edit="${u.id}">Editar</button>
                <button class="btn btn-ghost" data-toggle="${u.id}">${u.active? 'Desativar':'Ativar'}</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>

    <div style="height:12px"></div>

    <div class="card">
      <h4>Agendamentos (total: ${appts.length})</h4>
      <div class="small">Visualize e gerencie todos os agendamentos do sistema.</div>
      <div style="margin-top:10px">
        ${appts.length?appts.map(a=>`<div class="appt">${a.date} ${a.time} — <strong>${a.title}</strong> <div class="small">Usuário ID: ${a.userId} — Local: ${a.location}</div></div>`).join(''):'<div class="small">Sem agendamentos.</div>'}
      </div>
    </div>
  `;

  document.getElementById('app').innerHTML = html;

  document.getElementById('btn-logout').onclick = ()=>{currentUser=null;renderLogin()}
  document.getElementById('btn-export').onclick = ()=>exportCSV();
  document.getElementById('btn-new-user').onclick = ()=>renderAdminNewUser();

  // ações por botão
  document.querySelectorAll('[data-toggle]').forEach(btn=>{
    btn.onclick = ()=>{
      const id = Number(btn.getAttribute('data-toggle'));
      const users = loadUsers();
      const u = users.find(x=>x.id===id);
      u.active = !u.active; saveUsers(users); renderAdmin();
    }
  });
  document.querySelectorAll('[data-edit]').forEach(btn=>{
    btn.onclick = ()=>{
      const id = Number(btn.getAttribute('data-edit'));
      renderAdminEditUser(id);
    }
  });
}

function renderAdminNewUser(){
  const html = `
    <div class="card">
      <h3>Novo Usuário</h3>
      <div class="form-row"><input id="nu-name" placeholder="Nome" /></div>
      <div class="form-row"><input id="nu-email" placeholder="E-mail" /></div>
      <div class="form-row"><input id="nu-pass" placeholder="Senha" /></div>
      <div class="form-row"><select id="nu-role"><option value="user">Usuário</option><option value="admin">Administrador</option></select></div>
      <div style="display:flex;gap:8px"><button class="btn btn-primary" id="nu-save">Salvar</button>
      <button class="btn btn-ghost" id="nu-cancel">Cancelar</button></div>
    </div>
  `;
  document.getElementById('app').innerHTML = html;
  document.getElementById('nu-cancel').onclick = ()=>renderAdmin();
  document.getElementById('nu-save').onclick = ()=>{
    const name=document.getElementById('nu-name').value.trim();
    const email=document.getElementById('nu-email').value.trim();
    const pass=document.getElementById('nu-pass').value||'123456';
    const role=document.getElementById('nu-role').value;
    if(!name||!email){showMessage('Preencha nome e e-mail');return}
    const users = loadUsers();
    if(users.find(u=>u.email.toLowerCase()===email.toLowerCase())){showMessage('E-mail já existe');return}
    const id = (users.reduce((s,u)=>Math.max(s,u.id),0)||0)+1;
    users.push({id,name,email,password:pass,isAdmin:role==='admin',active:true});saveUsers(users);showMessage('Usuário criado');renderAdmin();
  }
}

function renderAdminEditUser(id){
  const users = loadUsers();
  const u = users.find(x=>x.id===id);
  const html = `
    <div class="card">
      <h3>Editar Usuário</h3>
      <div class="form-row"><input id="eu-name" value="${u.name}" /></div>
      <div class="form-row"><input id="eu-email" value="${u.email}" /></div>
      <div class="form-row"><input id="eu-pass" placeholder="Nova senha (opcional)" /></div>
      <div class="form-row"><select id="eu-role"><option value="user">Usuário</option><option value="admin">Administrador</option></select></div>
      <div style="display:flex;gap:8px"><button class="btn btn-primary" id="eu-save">Salvar</button>
      <button class="btn btn-ghost" id="eu-cancel">Cancelar</button></div>
    </div>
  `;
  document.getElementById('app').innerHTML = html;
  document.getElementById('eu-cancel').onclick = ()=>renderAdmin();
  document.getElementById('eu-save').onclick = ()=>{
    const name=document.getElementById('eu-name').value.trim();
    const email=document.getElementById('eu-email').value.trim();
    const pass=document.getElementById('eu-pass').value;
    const role=document.getElementById('eu-role').value;
    if(!name||!email){showMessage('Preencha nome e e-mail');return}
    u.name=name;u.email=email; if(pass)u.password=pass; u.isAdmin = role==='admin'; saveUsers(users); showMessage('Atualizado'); renderAdmin();
  }
}

function exportCSV(){
  const users = loadUsers();
  let csv = 'id,name,email,isAdmin,active\n';
  csv += users.map(u=>[u.id,u.name,u.email,u.isAdmin,u.active].join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='usuarios.csv'; a.click();
}

// --- Navegação simples ---
document.getElementById('link-login').onclick = (e)=>{e.preventDefault();currentUser=null;renderLogin()}
document.getElementById('link-register').onclick = (e)=>{e.preventDefault();renderRegister()}
document.getElementById('link-schedule').onclick = (e)=>{e.preventDefault();if(!currentUser)return renderLogin(); renderApp();}
document.getElementById('link-admin').onclick = (e)=>{e.preventDefault(); if(!currentUser) return renderLogin(); if(!currentUser.isAdmin) return showMessage('Acesso negado: precisa ser admin'); renderAdmin();}

// Inicialização
(function init(){
  loadUsers(); loadAppts(); renderLogin();
})();
</script>
</body>
</html>
